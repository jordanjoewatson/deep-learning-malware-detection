#!/bin/bash
# note that this file will make changes to the file system.
# also if using a large dataset this could take a long time to run
# it is highly advised to do this manually as it will be 
# easier to see what each file is doing

# set datadir to the directory that will hold the data, e.g. /home/user/dir/
# projectpath should be the path to the project root
# infection file name is the file used to infect the malware for adversarial variants
# this file must exist in the goodware dataset
datadir="/home/user/example/"
projectpath="/home/user/malwaredetection/"
infectionFilename="example.exe"

# Before running the script, the following commands must be done manually
# create three directories as followed
# mkdir ${DATAPATH}/goodwareFiles
# mkdir ${DATAPATH}/malwareFiles
# now copy the goodware and malware files for your own dataset into these directories
# copy the malware directory into a new directory
# cp -R ${DATAPATH}/malwareFiles ${DATAPATH}/adversarialFiles

echo "[*] Creating Adversarial Variants by injecting ${infectionFilename}"
python ${projectpath}src/adversarial-variants/fileInjection.py ${datadir}goodwareFiles/${infectionFilename} ${datadir}adversarialFiles/

echo "[*] Creating image directories"
mkdir ${datadir}goodwareFileImages
mkdir ${datadir}malwareFileImages
mkdir ${datadir}adversarialFileImages

echo "[*] Converting goodware files to images"
python3 ${projectpath}src/data-preparation/fileImageWriter.py -f ${datadir}goodwareFiles/ -g ${datadir}goodwareFileImages/ -r 32

echo "[*] Converting malware files to images"
python3 ${projectpath}src/data-preparation/fileImageWriter.py -f ${datadir}malwareFiles/ -g ${datadir}malwareFileImages/ -r 32

echo "[*] Converting adversarial variants to images"
python3 ${projectpath}src/data-preparation/fileImageWriter.py -f ${datadir}adversarialFiles/ -g ${datadir}adversarialFileImages/ -r 32

echo "[*] Finished"
